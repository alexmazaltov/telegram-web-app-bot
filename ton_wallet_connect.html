<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="MobileOptimized" content="176" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="robots" content="noindex,nofollow" />
    <!-- ... (existing head content) ... -->
    <title>TON Wallet Connection</title>
    <script src="https://telegram.org/js/telegram-web-app.js?2"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tonconnect/sdk@latest/dist/tonconnect-sdk.min.js"></script>
</head>
<body class="" style="visibility: hidden;">

<section id="top_sect" class="second">
    <h1>Connect TON Wallet</h1>
    <button id="connect_wallet_btn" onclick="DemoApp.connectWallet();">Connect Wallet</button>
    <div id="wallet_info" style="display: none;">
        <p>Wallet Address: <span id="wallet_address"></span></p>
        <p>TON Balance: <span id="wallet_balance"></span></p>
    </div>
    <button id="disconnect_wallet_btn" onclick="DemoApp.disconnectWallet();" style="display: none;">Disconnect Wallet</button>
</section>

<script type="application/javascript">
    const DemoApp = {
        tonConnectUI: null,
        
        init(options) {
            document.body.style.visibility = '';
            Telegram.WebApp.ready();
            Telegram.WebApp.MainButton.setParams({
                text: 'CLOSE WEBVIEW',
                is_visible: true
            }).onClick(DemoApp.close);

            // Initialize TON Connect
            this.tonConnectUI = new TonConnectSDK.TonConnectUI({
                manifestUrl: 'https://your-app-domain.com/tonconnect-manifest.json'
            });

            // Check if wallet is already connected
            this.checkWalletConnection();
        },

        connectWallet() {
            this.tonConnectUI.connectWallet()
                .then(() => {
                    this.updateWalletInfo();
                })
                .catch((error) => {
                    this.showAlert('Failed to connect wallet: ' + error.message);
                });
        },

        disconnectWallet() {
            this.tonConnectUI.disconnect()
                .then(() => {
                    document.getElementById('wallet_info').style.display = 'none';
                    document.getElementById('disconnect_wallet_btn').style.display = 'none';
                    document.getElementById('connect_wallet_btn').style.display = 'block';
                })
                .catch((error) => {
                    this.showAlert('Failed to disconnect wallet: ' + error.message);
                });
        },

        checkWalletConnection() {
            if (this.tonConnectUI.connected) {
                this.updateWalletInfo();
            }
        },

        updateWalletInfo() {
            const walletInfo = this.tonConnectUI.wallet;
            if (walletInfo) {
                document.getElementById('wallet_address').textContent = walletInfo.account.address;
                this.fetchTONBalance(walletInfo.account.address);
                document.getElementById('wallet_info').style.display = 'block';
                document.getElementById('disconnect_wallet_btn').style.display = 'block';
                document.getElementById('connect_wallet_btn').style.display = 'none';
            }
        },

        fetchTONBalance(address) {
            // This is a placeholder. You should implement actual balance fetching logic
            // using a TON blockchain API or your backend service.
            const mockBalance = (Math.random() * 100).toFixed(2);
            document.getElementById('wallet_balance').textContent = mockBalance + ' TON';
        },

        showAlert(message) {
            Telegram.WebApp.showAlert(message);
        },

        close() {
            Telegram.WebApp.close();
        }
    };

    // Initialize the app
    DemoApp.init();
</script>

</body>
</html>